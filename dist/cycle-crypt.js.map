{"version":3,"file":"cycle-crypt.js","sources":["../lib/string.js","../lib/randomBytes.js","../CycleCrypt.js","../cycle-crypt.js"],"sourcesContent":["/*requires Uint8Array*/\n/*globals escape, unescape, encodeURI, decodeURIComponent, btoa*/\n\nconst chr = String.fromCharCode;\n\nfunction ord(chr) {\n    return chr.charCodeAt(0);\n}\n\nexport function buffer2bin(buf) {\n    buf = view8(buf);\n    return chr.apply(String, buf);\n}\n\nexport function buffer2hex(buf) {\n    const bpe = buf.BYTES_PER_ELEMENT << 1;\n    return buf.reduce((r, c) => r += (c >>> 0).toString(16).padStart(bpe,'0'), '');\n}\n\nexport function buffer2str(buf, asUtf8) {\n    if(typeof buf == 'string') return buf;\n    buf = buffer2bin(buf);\n    if (asUtf8 !== false && !isASCII(buf)) {\n        if(asUtf8) {\n            buf = utf8Decode(buf);\n        } else if(asUtf8 == undefined) {\n            try {\n                buf = utf8Decode(buf);\n            } catch(err) {}\n        }\n    }\n    return buf;\n}\n\nexport function str2buffer(str, asUtf8) {\n    if(asUtf8 == undefined) {\n        // Some guessing\n        asUtf8 = hasMultibyte(str); // || !isASCII(str)\n    }\n    if (asUtf8) {\n        str = utf8Encode(str);\n    }\n    return new Uint8Array(str.split('').map(ord));\n}\n\n/**\n * This method is a replacement of Buffer.toString(enc)\n * for Browser, where Buffer is not available.\n *\n * @param   {String}  enc  'binary' | 'hex' | 'base64' | 'utf8' | undefined\n *\n * @return  {String}\n */\nexport function toString(enc) {\n    // The Node.js equivalent would be something like:\n    // if(typeof Buffer == 'function') {\n    //     if(enc === false) enc = 'binary';\n    //     if(enc === true) enc = 'utf8';\n    //     return Buffer.from(this.buffer, this.byteOffset, this.byteLength).toString(enc);\n    // }\n    switch(enc) {\n        case false:\n        case 'binary': return buffer2bin(this);\n        case 'hex': return buffer2hex(this);\n        case 'base64': return btoa(buffer2bin(this));\n        case 'utf8': enc = true; break;\n    }\n    return buffer2str(this, enc);\n}\n\nexport function view8(buf, start, len) {\n    // If buf is a Buffer, we still want to make it an Uint8Array\n    if(!start && !len && buf instanceof Uint8Array && !buf.copy) return buf;\n    start = start >>> 0;\n    if(len == undefined) len = buf.byteLength - start;\n    return new Uint8Array(buf.buffer, buf.byteOffset+start, len);\n}\n\nconst hasMultibyteRE = /([^\\x00-\\xFF]+)/;\nconst isASCIIRE = /^[\\x00-\\x7F]+$/;\n\nexport function hasMultibyte(str) {\n    let m = hasMultibyteRE.exec(str);\n    return m ? m[1] : false;\n}\n\nexport function isASCII(str) {\n    return isASCIIRE.test(str);\n}\n\nexport function utf8Encode(str) {\n    return unescape(encodeURI(str));\n}\n\nexport function utf8Decode(str) {\n    return decodeURIComponent(escape(str));\n}\n","/*requires Uint8Array, Uint32Array*/\n\nimport { toString } from \"./string\";\n\nexport default function randomBytes(size) {\n    const bits = -1 >>> 0;\n\n    let len = size & 3;\n    len = len ? size + 4 - len : size;\n    let ret = new Uint8Array(len);\n    const words = new Uint32Array(ret.buffer);\n    let ent = Date.now();\n\n    len >>= 2;\n    while (len--) {\n        words[len] =\n        ent ^= Math.random() * bits;\n    }\n\n    if(ret.length > size) {\n        ret = ret.slice(0, size);\n    }\n\n    ret.toString = toString;\n    return ret;\n}\n","/*requires Uint8Array, Uint32Array*/\n\nimport randomBytes from './lib/randomBytes';\nimport { str2buffer, view8, toString } from './lib/string';\n\n/**\n * Variable size symmetric key encryption algorithm.\n * The cipher-key is generated by cycling the input key with a variation of XorShift+ PRNG.\n * The bigger the key-size, the longer the period.\n *\n * @param   {String|ArrayBuffer}  key   The encryption key\n * @param   {String|ArrayBuffer|Boolean} salt\n *              If a string, use it as salt.\n *              If TRUE, generate salt.\n */\nexport default function CycleCrypt(key, salt = true) {\n    const self = this;\n\n    key = str2buf(key);\n    if (salt === true) {\n        salt = randomBytes(Math.min(256, key.byteLength << 1));\n    }\n    self.salt = salt;\n    self._key = key = saltKey(key, str2buf(salt));\n}\n\nObject.defineProperties(CycleCrypt.prototype, {\n    constructor: {\n        value: CycleCrypt,\n    },\n\n    /**\n     * Encrypt/decrypt the data and advance the internal state of the cipher-key.\n     *\n     * @param   {String|ArrayBuffer}  data  Data to encrypt\n     *\n     * @return  Uint8Array The encrypted/decrypted data\n     */\n    _: {\n        value: function _(data) {\n            data = str2buf(data);\n            const { dataLength } = data;\n            if (!dataLength) return data;\n\n            const key = this._key;\n            let klen = key.length;\n            let len = data.length;\n            for (let i = 0, k=0; i < len; ++i, ++k) {\n                // let k = i % klen;\n                if(k === klen) k = 0;\n                if (!k) mixKey(key);\n                data[i] ^= key[k];\n            }\n\n            data = view8(data, 0, dataLength);\n            data.toString = toString;\n            return data;\n        }\n    },\n\n    /**\n     * Get the number of bytes in the key\n     *\n     * @return  int\n     */\n    keyByteSize: {\n        get() {\n            return this._key.byteLength;\n        }\n    }\n});\n\n// Static methods:\nCycleCrypt.randomBytes = randomBytes; // Uint8Array\nCycleCrypt.toString = toString;\nCycleCrypt.str2buffer = str2buffer; // Uint8Array\nCycleCrypt.str2buf = str2buf; // Uint32Array\n// // CycleCrypt.buf2str = buf2str;\n\n/**\n * Use a variation of Xorshift+ to mix the key\n *\n * @param   Uint32Array $key List of int32 values representing the key\n * @param   int   $rounds Number of rounds to process the key\n *\n * @return  array A mixed key\n */\nfunction mixKey(key, rounds = 1) {\n    let len = key.length;\n    let k = len > 1 ? key[len - 1] : 0;\n    while (rounds-- > 0) {\n        for (let $i = len; $i--;) {\n            let ki = $i % len;\n            k = key[ki] + k;\n            k ^= k << 13; // 19\n            k ^= k >>> 17; // 15\n            k ^= k << 5; // 27\n            // k >>>= 0;\n            key[ki] = k;\n        }\n    }\n\n    return key;\n}\n\n/**\n * Use a variation of Xorshift+ to salt the key\n *\n * @param   Uint32Array $key\n * @param   Uint32Array $salt\n * @param   int   $rounds Number of rounds to mix the key\n *\n * @return  array A mixed key\n */\nfunction saltKey(key, salt, rounds = 1) {\n    let klen = key.length;\n    let slen = salt.length;\n    if (!slen) return key;\n\n    // make a copy to avoid altering the input salt\n    salt = salt.slice();\n\n    let k = klen > 1 ? key[klen - 1] : 0;\n    let s = slen > 1 ? salt[slen - 1] : 0;\n\n    while (rounds-- > 0) {\n        for (let i = Math.max(klen, slen); i--;) {\n            let ki = i % klen;\n            let si = i % slen;\n            k = key[ki] + k;\n            s = salt[si] + s;\n\n            s ^= s << 13; // 19\n            s ^= s >>> 7; // 25\n\n            k ^= k << 11; // 21\n            k ^= k >>> 8; // 24\n\n            // s >>>= 0;\n            k += s;\n            // k >>>= 0;\n\n            key[ki] = k;\n            salt[si] = s;\n        }\n    }\n\n    return key;\n}\n\nfunction str2buf(str) {\n    if (!str || typeof str.byteLength != 'number') {\n        str = str2buffer(str);\n    }\n    else {\n        str = view8(str);\n    }\n\n    // Make sure the new buffer has a multiple of 4 byteLength\n    const { byteLength } = str;\n    let b = byteLength & 3;\n    let i;\n    // if(b) {\n        b = byteLength + (b && (4 - b));\n        i = new Uint8Array(b);\n        i.set(str);\n    // }\n    // else {\n    //     b = byteLength;\n    //     i = str.slice();\n    // }\n\n    str = new Uint32Array(i.buffer, i.byteOffset, b >> 2);\n    str.dataLength = byteLength;\n\n    return str;\n}\n\n// Unused\n// function buf2str(buf) {\n//     return buffer2str(view8(buf));\n// }\n","// ---------------------------------------------------------------\n/*requires Uint8Array, Uint32Array*/\n// ---------------------------------------------------------------\nimport CycleCrypt from './CycleCrypt';\nimport { str2buffer, view8 } from './lib/string';\n\ncycleCrypt.CycleCrypt = CycleCrypt;\ncycleCrypt.randomBytes = CycleCrypt.randomBytes;\ncycleCrypt.str2buffer = CycleCrypt.str2buffer;\n\n// ---------------------------------------------------------------\n/**\n * Simple encryption using xor, a key and salt.\n *\n * @param   string|Uint8Array  $key   The encryption key\n * @param   string|Uint8Array  $data  Data to encrypt\n * @param   string|Uint8Array|bool $salt\n *              If a string, use it as salt.\n *              If TRUE, generate salt and prepend it to the encrypted data.\n *              If FALSE, get the salt from the data.\n *\n * @return  Uint8Array  The encrypted data. If $salt is TRUE, the generated salt is prepended to the result.\n */\nexport default function cycleCrypt(key, data, salt = true) {\n\n    // Read salt from input\n    if (salt === false) {\n        data = view8(typeof data == 'string' ? str2buffer(data) : data);\n        let i = data[0];\n        salt = data.slice(1, ++i);\n        data = data.slice(i);\n    }\n\n    const cc = new CycleCrypt(key, salt);\n    data = cc._(data);\n\n    // Add the generated salt to the output\n    if (salt === true) {\n        salt = cc.salt;\n        let ret = new Uint8Array(1 + salt.byteLength + data.byteLength);\n        ret[0] = salt.byteLength;\n        ret.set(salt, 1);\n        ret.set(data, 1 + ret[0]);\n        ret.toString = data.toString;\n        data = ret;\n    }\n\n    return data;\n}\n"],"names":["chr","String","fromCharCode","ord","charCodeAt","buffer2bin","buf","view8","apply","buffer2hex","bpe","BYTES_PER_ELEMENT","reduce","r","c","toString","padStart","buffer2str","asUtf8","isASCII","utf8Decode","undefined","err","str2buffer","str","hasMultibyte","utf8Encode","Uint8Array","split","map","enc","btoa","start","len","copy","byteLength","buffer","byteOffset","hasMultibyteRE","isASCIIRE","m","exec","test","unescape","encodeURI","decodeURIComponent","escape","randomBytes","size","bits","ret","words","Uint32Array","ent","Date","now","Math","random","length","slice","CycleCrypt","key","salt","self","str2buf","min","_key","saltKey","Object","defineProperties","prototype","constructor","value","_","data","dataLength","klen","i","k","mixKey","keyByteSize","get","rounds","$i","ki","slen","s","max","si","b","set","cycleCrypt","cc"],"mappings":"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"}